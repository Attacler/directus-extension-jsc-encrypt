"use strict";var t=require("crypto");var n=({filter:t,action:n},{env:e})=>{const c={};for(const t of e.DE_ENCRYPTION){const[n]=t.split(".");null==c[n]&&(c[n]=[]),c[n].push(t.replace(n+".",""))}console.log(c,e.DE_KEY),n("items.read",(async({collection:t,payload:n})=>{if(null!=c[t])for(const o of n)for(const n of c[t])null!=o[n]&&o[n].length>0&&(o[n]=r(o[n],e.DE_KEY))})),t("items.update",(async(t,n)=>{const{collection:r}=n;if(null!=c[r])for(const n of c[r])null!=t[n]&&t[n].length>0&&(t[n]=o(t[n],e.DE_KEY))})),t("items.create",(async(t,n)=>{const{collection:r}=n;if(null!=c[r])for(const n of c[r])null!=t[n]&&t[n].length>0&&(t[n]=o(t[n],e.DE_KEY))}))};const e="aes-256-ctr";function o(n,o){const r="string"==typeof n?1:0;r||(n=JSON.stringify(n));const c=t.randomBytes(16),l=t.createCipheriv(e,o,c),f=Buffer.concat([l.update(n),l.final()]);return r+":"+c.toString("hex")+":"+f.toString("hex")}function r(n,o){const[r,c,l]=n.split(":"),f=t.createDecipheriv(e,o,Buffer.from(c,"hex")),s=Buffer.concat([f.update(Buffer.from(l,"hex")),f.final()]).toString();if("1"==r)return s;try{return JSON.parse(s)}catch(t){return s}}module.exports=n;
